<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style></style>
</head>
<body>
<button id="btn">申请全屏</button>
<button id="unlockBtn">接触屏幕旋转锁定</button>
<script type="module">
    let JSONParseCustomController=class extends Object{props;node=null;constructor(node,props={}){super();this.node=node;this.props=props}render(){for(let name in this.props){this.node[name]=this.props[name]}if(!this.node.querySelector(".provider")){if(this.node.querySelector("input")){this.node.querySelector("input").classList="provider"}else if(this.node.querySelector("select")){this.node.querySelector("select").classList="provider"}else if(this.node.querySelector("textarea")){this.node.querySelector("textarea").classList="provider"}else{this.node.classList="provider"}}return this.node}};let JSONParseRangeController=class extends JSONParseCustomController{min=0;max=5;step=1;constructor(min,max,step,props={}){super(null,props);this.min=min;this.max=max;this.step=step}render(){let div=document.createElement("div");div.innerHTML=`<label>${this.min}<input type="range"class="provider"min="${this.min}"max="${this.max}"step="${this.step}"value="${this.min}"/>${this.max}</label>`;this.node=div.children[0];return super.render()}};let JSONParseDateController=class extends JSONParseCustomController{constructor(props={}){super(null,props)}render(){let div=document.createElement("div");div.innerHTML=`<label><input type="date"class="provider"/></label>`;this.node=div.children[0];return super.render()}};let JSONParseTimeController=class extends JSONParseCustomController{constructor(props={}){super(null,props)}render(){let div=document.createElement("div");div.innerHTML=`<label><input type="time"class="provider"/></label>`;this.node=div.children[0];return super.render()}};let JSONParserEvent=class extends Event{key;value;json;jsonParser;cancelBubble=false;constructor({key,value,json,jsonParser}){super("jsonchange");this.key=key;this.value=value;this.json=json;this.jsonParser=jsonParser}};JSONParserEvent.prototype.stopPropagation=function(){this.cancelBubble=true};let stringToPrimary=function(str){let temp=Number.isNaN(str-0)?str:str-0;(temp==="true"||temp==="false")&&(temp=(temp==="true"));return temp};let defaultInputEvent=function(ev,that){let temp=stringToPrimary(this.value??this.getAttribute("value"));const keyName=this.name??this.getAttribute("name");that.json[keyName]=temp;const event=new JSONParserEvent({json:that.json,value:temp,key:keyName,jsonParser:that,isTrusted:true});that.onJsonChange&&that.onJsonChange(event);that.dispatchEvent(event)};let JSONParser=class extends EventTarget{tableContainer=null;json={};valueToKey=new Map();cellToKey=new Map();children=[];parent=null;constructor(json){super();this.json=json};initTable(){let container=document.createElement("section");container.className="table-container";this.tableContainer=container;container.innerHTML=`<table><thead><tr><th>key</th><th>value</th></tr></thead><tbody></tbody></table>`;const tbody=container.querySelector("tbody");for(let name in this.json){this.valueToKey.set(this.json[name],name);let tr=document.createElement("tr");let tdName=document.createElement("td");tdName.innerHTML=`<input type='checkbox'id='${name}-using'checked>`;tdName.innerHTML+=name;this.cellToKey.set(tdName,name);let tdValue=document.createElement("td");if(this.json[name]instanceof JSONParseCustomController){let customNode=this.json[name];tdValue.appendChild(customNode.render());let that=this;let provider=tdValue.querySelector('.provider')||tdValue.children[0];provider.name=name;provider.addEventListener("input",function(ev){defaultInputEvent.call(this,ev,that)})}else if(this.json[name]instanceof Array){tdValue.innerHTML=`<select name="${name}"class="json-input"id="jsonparse-${name}">${(function(data){let res="";data.forEach(val=>{res+="<option>"+val+"</option>"});return res})(this.json[name])}</select>`;let that=this;tdValue.children[0].addEventListener("input",function(ev){defaultInputEvent.call(this,ev,that)})}else if(this.json[name]instanceof Object){const jsonParser=new JSONParser(this.json[name]);tdValue.appendChild(jsonParser.initTable());jsonParser.parent=this;let that=this;let customJsonChangeEventSymbol=Symbol.for['customJsonChangeEvent'];Object.defineProperty(jsonParser,"onJsonChange",{set:function(func){jsonParser[customJsonChangeEventSymbol]=func},get:_=>{let defaultBubbleEvent=function(ev){let that2=this;if(!ev.cancelBubble&&this===ev.jsonParser)that.jsonChange(new JSONParserEvent({json:that2.parent.json,key:name,value:ev.json,jsonParser:that}))}.bind(jsonParser);return function(ev){jsonParser[customJsonChangeEventSymbol]?jsonParser[customJsonChangeEventSymbol](ev):null;defaultBubbleEvent(ev)}},configurable:true,enumerable:true});this.children.push(jsonParser)}else{let temp=stringToPrimary(this.json[name]);if(typeof this.json[name]==="number"){tdValue.innerHTML=`<input type="number"value="${this.json[name]}"name="${name}"class="json-input"id="jsonparse-${name}"/>`}else if(typeof this.json[name]==="boolean"){tdValue.innerHTML=`<label name="${name}"><input type="checkbox"value="${this.json[name]}"name="${name}"class="json-input provider"id="jsonparse-${name}"/><span>${this.json[name]}</span></label>`;let label=tdValue.children[0];let checkbox=tdValue.children[0].querySelector("input");let display=tdValue.children[0].querySelector("span");if(this.json[name])checkbox.checked=true;checkbox.addEventListener("input",function(){this.value=this.checked;label.setAttribute("value",this.checked);display.innerText=this.checked})}else if(typeof this.json[name]==="string"){tdValue.innerHTML=`<input type="text"value="${this.json[name]}"name="${name}"class="json-input"id="jsonparse-${name}"/>`}let that=this;tdValue.children[0].addEventListener("input",function(ev){defaultInputEvent.call(this,ev,that)})}this.cellToKey.set(tdValue,this.json[name]);tr.appendChild(tdName);tr.appendChild(tdValue);let that=this;let usingCheck=tdName.children[0];usingCheck.onchange=function(ev){defaultInputEvent.call(tdValue.children[0],ev,that)};tbody.appendChild(tr)}return container};toJSON(){const that=this;const table=that.tableContainer.querySelector("table");let getTableValue=function(table){const tbody=table.querySelector("tbody");const trs=Array.from(tbody.children);let res={};trs.forEach(function(tr,index,array){let usingChecked=tr.cells[0].children[0];let key=tr.cells[0].innerText;let value;if(!usingChecked.checked)return false;if(tr.cells[1].querySelector("table")===null){value=tr.cells[1].children[0].value??tr.cells[1].querySelector('.provider').value;value=stringToPrimary(value)}else if(tr.cells[1].querySelector("table")!==null){let table=tr.cells[1].querySelector("table");value=getTableValue(table)}res[key]=value});return res};return getTableValue(table)}onJsonChange(ev){};import(href){let linkEle=document.createElement("link");linkEle.href=href;linkEle.rel="stylesheet";linkEle.type="text/css";document.head.appendChild(linkEle)};jsonChange(ev){this.onJsonChange(ev||new JSONParserEvent({json:this.json,jsonParse:this}))}[Symbol.for("customJsonChangeEvent")](){}setDefaultStyle(){let cssText=`table{border-collapse:collapse}td{border:#639 solid 3px;padding:.5em 1em}body>section>table>thead>tr>th{border:#639 solid 3px}td:nth-child(2)>input,td:nth-child(2)>select{padding:0.5em;min-width:100px}`;let stylesheet=document.createElement("style");stylesheet.innerHTML=cssText;document.head.appendChild(stylesheet)}render(container=document.body){container.appendChild(this.initTable())};defaultInit(){this.setDefaultStyle();this.render()}set onjsonchange(func){this.onJsonChange=func}get onjsonchange(){return this.onJsonChange}};export{JSONParser,JSONParseCustomController,JSONParserEvent,JSONParseRangeController,JSONParseDateController,JSONParseTimeController,}
    let Console=class extends Object{#consoleStyleSheet=`#console-panel{background-color:#000;color:#fff;index:10;height:100vh;width:100vw;overflow-y:scroll;position:fixed;top:0;left:0}#console-panel>p{word-break:break-all;font-family:Source Code Pro;font-size:1.2rem;padding:.2em 1em;color:transparent;text-shadow:0 0 0#fff;outline:none}#console-panel*{word-break:break-all;font-family:Source Code Pro;font-size:1.2rem;padding:.2em 1em}#console-panel>p.editable{cursor:default}@keyframes inputPointer{from{border-bottom-style:solid}to{border-bottom-style:none}}#console-panel>p.editable::after{content:" ";display:inline-block;width:10px;margin-left:5px;border-bottom:#fff 7px solid;animation-name:inputPointer;animation-duration:.2s;animation-timing-function:linear;animation-direction:alternate;animation-iteration-count:infinite}`;#consoleInlineStyleSheet=`#console-panel{background-color:#000;color:#fff;index:10;position:fixed;top:0;right:0;height:100%;width:30%;overflow-y:scroll;transition:.3s}#console-panel-cancel-btn{position:fixed;top:0;right:30%;height:100%;width:1rem;border:none;transition:.3s}#console-panel>p{word-break:break-all;font-family:Source Code Pro;font-size:1.2rem;padding:.2em 1em;color:transparent;text-shadow:0 0 0#fff;outline:none}#console-panel*{word-break:break-all;font-family:Source Code Pro;font-size:1.2rem;padding:.2em 1em}#console-panel>p.editable{cursor:default}@keyframes inputPointer{from{border-bottom-style:solid}to{border-bottom-style:none}}#console-panel>p.editable::after{content:" ";display:inline-block;width:10px;margin-left:5px;border-bottom:#fff 7px solid;animation-name:inputPointer;animation-duration:.2s;animation-timing-function:linear;animation-direction:alternate;animation-iteration-count:infinite}#console-panel.cancel{right:-30%}#console-panel-cancel-btn.cancel{right:0%}`;#inputHistory=[];#consolePanel=null;#editingInput=null;autoFinish=true;timer=null;updateTimer(){if(!this.autoFinish)return false;if(this.timer)clearTimeout(this.timer);if(!this.#getEditingInput())this.timer=setTimeout(this.end.bind(this),10)}cancelTimer(){if(!this.autoFinish)return false;clearTimeout(this.timer);this.timer=null}#setEditingInput(htmlPElement){if(htmlPElement){htmlPElement.contentEditable=true;htmlPElement.classList.add("editable");this.#editingInput=htmlPElement;this.cancelTimer()}else{this.#editingInput.contentEditable=false;this.#editingInput.classList.remove("editable");this.#editingInput=htmlPElement;this.updateTimer()}let that=this;return new Promise(resolve=>{if(!htmlPElement){resolve()}let historyPointer=0;that.#editingInput?.addEventListener("keydown",function(ev){if(ev.key.toLowerCase()==="enter"){ev.preventDefault();resolve()}else if(ev.key.toLowerCase()==="space"){this.innerText+=" "}else if(ev.key==="ArrowUp"){if(historyPointer>=that.#inputHistory.length)return false;this.innerText=that.#inputHistory[that.#inputHistory.length-(++historyPointer)];const range=document.createRange();const selection=window.getSelection();range.selectNodeContents(that.#editingInput);range.collapse(false);selection.removeAllRanges();selection.addRange(range)}else if(ev.key==="ArrowDown"){if(historyPointer<=1)return false;this.innerText=that.#inputHistory[that.#inputHistory.length-(--historyPointer)];const range=document.createRange();const selection=window.getSelection();range.selectNodeContents(this);range.collapse(false);selection.removeAllRanges();selection.addRange(range)}else if(ev.key.toLowerCase()==="c"&&ev.ctrlKey){ev.preventDefault();this.innerText+="^C";resolve()}});that.#editingInput?.addEventListener("keyup",function(ev){if(ev.key.toLowerCase()==="backspace"){if(this.innerText.trim()===""&&this.children[0]?.tagName==="BR"){this.removeChild(this.children[0])}}});that.#editingInput?.addEventListener("focus",function(ev){const range=document.createRange();const selection=window.getSelection();range.selectNodeContents(this);range.collapse(false);selection.removeAllRanges();selection.addRange(range)});that.#editingInput?.addEventListener("blur",function(ev){});that.#editingInput.focus()})};#getEditingInput(){return this.#editingInput};renderAsConsoleApp(container=document.body){let consolePanel=document.createElement("div");consolePanel.id="console-panel";this.#consolePanel=consolePanel;let stylesheet=new CSSStyleSheet();stylesheet.replaceSync(this.#consoleStyleSheet);document.adoptedStyleSheets=[stylesheet];container.appendChild(consolePanel);let that=this;document.addEventListener("keydown",function(){if(!that.#getEditingInput())return false;that.#getEditingInput().focus()});this.updateTimer();return consolePanel}renderAsConsoleInline(container=document.body){let consolePanel=document.createElement("div");consolePanel.id="console-panel";let consolePanelCancelBtn=document.createElement("button");consolePanelCancelBtn.id="console-panel-cancel-btn";consolePanelCancelBtn.innerText="||";container.appendChild(consolePanelCancelBtn);container.appendChild(consolePanel);this.#consolePanel=consolePanel;let stylesheet=new CSSStyleSheet();stylesheet.replaceSync(this.#consoleInlineStyleSheet);document.adoptedStyleSheets=[stylesheet];let that=this;this.#consolePanel.addEventListener("click",function(){if(!that.#getEditingInput())return false;that.#getEditingInput().focus()});consolePanelCancelBtn.addEventListener("click",function(){that.#consolePanel.classList.toggle("cancel");this.classList.toggle("cancel")});this.autoFinish=false;this.updateTimer();return consolePanel}#initItem(msg){let p=document.createElement("p");msg=msg?.toString()||msg+"";msg=msg.replaceAll(String.fromCharCode(32),String.fromCharCode(160));p.innerHTML=msg;if(this.#getEditingInput()){this.#getEditingInput().insertAdjacentElement("beforebegin",p)}else{this.#consolePanel.appendChild(p)}p.scrollIntoView();return p}output(...msgs){let that=this;this.#initItem(msgs.join(" "));this.updateTimer()}error(...msgs){let that=this;msgs.forEach(msg=>{let p=that.#initItem("Error: "+msg);p.style.color="red"});this.updateTimer()}warn(...msgs){let that=this;msgs.forEach(msg=>{let p=that.#initItem("Warn: "+msg);p.style.color="yellow"});this.updateTimer()}end(msg="The program has ended...."){this.output(msg);this.cancelTimer();this.autoFinish=false}async inputs(){let res=await this.input();return res.trim().split(/\s+/)}async input(){if(this.#getEditingInput()){return false}let p=this.#initItem("");await this.#setEditingInput(p);let res=this.#getEditingInput().innerText;await this.#setEditingInput(null);res=res.replaceAll(String.fromCharCode(160),String.fromCharCode(32));this.#inputHistory.push(res);return res}clear(){this.#inputHistory=[];this.cancelTimer();this.#consolePanel.innerHTML=""}};export{Console};


    document.addEventListener("DOMContentLoaded", async function () {
        const button = document.getElementById("btn");
        const unlockBtn = document.getElementById("unlockBtn");

        const con = new Console();
        con.renderAsConsoleInline();

        const screenOrientation = screen.orientation;



        con.output("screenOrientation");
        con.output("-------------------");


        const param = {
            type: ["any", "natural", "landscape", "portrait", "landscape-primary", "landscape-secondary", "portrait-primary", "portrait-secondary"]
        };
        const jsonParse = new JSONParser(param);
        jsonParse.defaultInit();

        jsonParse.onjsonchange = async function () {
            const res = await screenOrientation.lock(this.json.type).catch(e =>{
                con.output(e.message)
            });
            con.output("屏幕已按" + this.json.type + "方式锁定", res);
        }


        button.onclick = async function (){
            await document.body.requestFullscreen().catch(e =>{
                con.output(e.message)
            });
        };

        unlockBtn.onclick = async function (){
            await screenOrientation.unlock().catch(e =>{
                con.output(e.message)
            });
        }


        screenOrientation.onchange = function (){
            con.output("屏幕已旋转", screenOrientation.angle);
            con.output("type", screenOrientation.type);
        }

    })
</script>
</body>
</html>